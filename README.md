# 智能家居控制面板

基于 ESP32-S3 和 LVGL 9 开发的智能家居控制面板，支持多种智能设备控制和实时数据显示。

## 项目概述

本项目是一个基于 ESP32-S3 微控制器和 LVGL 9 图形库开发的智能家居控制面板，采用 XML 模式编写界面，实现了数据驱动的架构设计。该面板支持多种智能设备控制、实时数据显示、MQTT 通信等功能，可作为智能家居系统的中心控制终端。

## 硬件要求

- **主控芯片**：ESP32-S3-WROOM-1-N8R8
- **显示屏**：基于 ST7701S 驱动的彩色触摸屏
- **触摸屏驱动**：GT911
- **其他外设**：HT16 数码管、TQZT50 传感器等

## 软件要求

- **开发框架**：ESP-IDF v5.0 或更高版本
- **图形库**：LVGL 9
- **MQTT 客户端**：ESP-IDF MQTT 组件
- **WiFi 管理**：ESP-IDF WiFi 组件

## 项目结构

```
├── main/                 # 主程序目录
│   ├── components/       # 自定义组件
│   ├── drivers/          # 硬件驱动
│   ├── fonts/            # 字体文件
│   ├── images/           # 图片资源
│   ├── include/          # 头文件
│   ├── screens/          # 屏幕界面
│   ├── src/              # 源代码
│   └── ui/               # UI 相关文件
├── components/           # 第三方组件
│   └── GT911/            # GT911 触摸屏驱动
├── build/                # 构建输出目录
├── .gitignore            # Git 忽略文件配置
├── CMakeLists.txt        # CMake 配置文件
├── README.md             # 项目说明文档
└── sdkconfig             # ESP-IDF 配置文件
```

## 功能特性

### 1. 设备控制
- 支持多种智能设备的控制
- 实时显示设备状态
- 设备分组管理

### 2. 实时数据显示
- 天气信息显示
- 温湿度数据
- 能耗数据统计

### 3. 通信功能
- WiFi 连接管理
- MQTT 协议支持
- 远程数据同步

### 4. 用户界面
- 基于 LVGL 9 XML 模式开发
- 响应式设计
- 主题切换支持

### 5. 其他功能
- 设备配网功能
- 系统状态监控
- 日志记录

## 快速开始

### 1. 环境搭建

1. 安装 ESP-IDF 开发环境
2. 克隆本项目到本地
3. 进入项目目录

### 2. 配置项目

```bash
# 使用 menuconfig 配置项目
idf.py menuconfig
```

在配置菜单中，您可以设置：
- WiFi SSID 和密码
- MQTT 服务器地址
- 显示屏参数
- 其他硬件配置

### 3. 编译和烧录

```bash
# 编译项目
idf.py build

# 烧录固件到 ESP32-S3
idf.py flash -p /dev/ttyUSB0 -b 460800

# 查看串口输出
idf.py monitor -p /dev/ttyUSB0
```

## 开发指南

### 1. 界面开发

项目使用 LVGL 9 的 XML 模式开发界面，界面文件位于 `main/screens/` 目录下。您可以使用 LVGL Editor 编辑界面，然后将生成的 XML 文件导入到项目中。

### 2. 添加新设备支持

要添加新的智能设备支持，您需要：
1. 在 `main/include/` 目录下创建设备相关的头文件
2. 在 `main/src/` 目录下实现设备控制逻辑
3. 在界面中添加对应的控制组件
4. 配置 MQTT 主题和消息格式

### 3. 数据驱动架构

项目采用数据驱动的架构设计，所有界面元素都绑定到一个 Subject 上，通过 Subject 来更新数据。这种设计使得数据更新和界面刷新分离，提高了代码的可维护性和扩展性。

## 配置说明

### 1. WiFi 配置

WiFi 配置位于 `main/src/wifi_manager.c` 文件中，支持两种配置方式：
- 硬编码配置：在代码中直接设置 SSID 和密码
- 配网模式：通过访问设备创建的 WiFi 热点进行配置

### 2. MQTT 配置

MQTT 配置位于 `main/src/mqtt_client.c` 文件中，您可以配置：
- MQTT 服务器地址和端口
- 客户端 ID
- 用户名和密码
- 主题前缀

### 3. 显示屏配置

显示屏配置位于 `main/src/st7701s.c` 文件中，您可以调整：
- 屏幕分辨率
- 刷新率
- 颜色格式
- 背光亮度

## 调试和日志

项目使用 ESP-IDF 的日志系统，支持不同级别的日志输出。您可以在 `menuconfig` 中配置日志级别，或者在代码中使用以下宏来输出日志：

```c
ESP_LOGE(tag, format, ...);  // 错误日志
ESP_LOGW(tag, format, ...);  // 警告日志
ESP_LOGI(tag, format, ...);  // 信息日志
ESP_LOGD(tag, format, ...);  // 调试日志
ESP_LOGV(tag, format, ...);  // 详细日志
```

## 许可证

本项目采用 MIT 许可证，详见 `LICENSE` 文件。

## 贡献

欢迎提交 Issue 和 Pull Request，帮助改进项目。

## 联系方式

- 作者：codingsoul
- 邮箱：yylcy@vip.qq.com

## 更新日志

### v1.0.0 (2026-01-23)
- 初始版本发布
- 支持基本的设备控制和数据显示
- 实现 MQTT 通信功能
- 完成 WiFi 管理功能
- 实现天气信息显示

---

**注意**：本项目仍在持续开发中，功能和接口可能会随时变更。请定期更新代码以获取最新功能和 bug 修复。